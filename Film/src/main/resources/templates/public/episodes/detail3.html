<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" th:replace="~{/public/layout/layout :: main-fragment(
~{:: title},
~{:: #css-resources},
~{:: #main-content},
~{:: #js-resources}
)}">

<head>
    <!-- Basic need -->
    <title>Block Buster | Movie Player</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <th:block id="css-resources">
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
                href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800;900&display=swap"
                rel="stylesheet"
        />
        <link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Dosis:400,700,500|Nunito:300,400,600' />
        <link rel="icon" th:href="@{/public/images/movie-reel.png}">
        <link rel="stylesheet" th:href="@{/public/css/plugins.css}">
        <link rel="stylesheet" th:href="@{/public/css/style.css}">
        <link rel="stylesheet" th:href="@{/public/css/style_movie_home.css}">
        <link rel="stylesheet" th:href="@{/public/css/all.min.css}">
        <link rel="stylesheet" th:href="@{/public/css/google-fonts-fallback.css}">
        <link rel="stylesheet" th:href="@{https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200}" />
        <link rel="stylesheet" th:href="@{https://fonts.googleapis.com/icon?family=Material+Icons}">
    </th:block>
</head>
<body>

<main id="main-content">
    <span style="display: none" class="idMovie" th:text="${getMovie.id}"></span>
    <span style="display: none" class="idAccount" th:text="${account_id}"></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
    <br>  <br>  <br>  <br>  <br>  <br>  <br>  <br>

    <div class="trailers full-width" style="height: 1000px">
        <!--   -->
        <div class=" row ipad-width">
            <!--           " style="margin-top: 100px;-->
            <div class="">
                <!--                col-md-9 col-sm-12 col-xs-12-->
                <div class="frameTitleMovie">
                    <span>Block Buster</span>
                    <span>/</span>
                    <span><a th:text="${getMovie.genre.name}" th:href="'/movie/genre/' + ${getMovie.genre.id}"></a></span>
                    <span>/</span>
                    <span><a th:text="${getMovie.name}" th:href="'/movie/get/' + ${getMovie.id}"></a></span>
                    <span>/</span>
                    <span th:text="${getEpisode.name}"></span>
                </div>
                <section class="videos">
                    <div class="slider-for-2 video-ft" th:if="${getEpisode.movieId.isApi == 0}">
                        <div class="video-container" >
                           <div id="episode-number" style="position: absolute">
                               <video id="video" style="width: 1280px">
                                   <source style="width: 100%"  th:src="${getEpisode.link}" type=video/mp4>
                                Your browser does not support the video tag.</video>
                           </div>
                            <span class="custom-loader"></span>
                            <div class="player-state" style="top: 50%; transform: translateY(-50%)">
									<span class="state-btn state-backward">
									  <ion-icon name="play-back-outline"></ion-icon>
									  <span class="backward-duration">5</span>
									</span>
                                <span class="main-state state-btn">
									  <ion-icon name="play-outline"></ion-icon>
									</span>
                                <span class="state-btn state-forward">
									  <span class="forward-duration">5</span>
									  <ion-icon name="play-forward-outline"></ion-icon>
									</span>
                            </div>
                            <div class="controls">
                                <div class="duration">
                                    <div class="current-time"></div>
                                    <div class="hover-time">
                                        <span class="hover-duration"></span>
                                    </div>
                                    <div class="buffer"></div>
                                </div>
                                <div class="btn-controls">
                                    <div class="btn-con">
										<span class="play-pause control-btn" id="clickPlay">
										  <ion-icon name="play-outline"></ion-icon>
										</span>
                                        <span class="volume">
										  <span class="mute-unmute control-btn">
											<ion-icon name="volume-high-outline"></ion-icon>
										  </span>
										  <div class="max-vol">
											<div class="current-vol"></div>
										  </div>
										</span>
                                        <span class="time-container">
										  <span class="current-duration">0:00</span>
										  <span>/</span>
										  <span class="total-duration">0:00</span>
										</span>
                                    </div>
                                    <div class="right-controls">
										<span class="backward control-btn" title="5 backward">
										  <ion-icon name="play-back-outline"></ion-icon>
										</span>
                                        <span class="forward control-btn" title="5 forward">
										  <ion-icon name="play-forward-outline"></ion-icon>
										</span>
                                        <span class="mini-player control-btn">
										  <ion-icon name="albums-outline"></ion-icon>
										</span>
                                        <span class="settings control-btn">
										  <span class="setting-btn">
											<ion-icon name="options-outline"></ion-icon>
										  </span>
										  <ul class="setting-menu">
											<li data-value="0.25">0.25x</li>
											<li data-value="0.5">0.5x</li>
											<li data-value="0.75">0.75x</li>
											<li data-value="1" class="speed-active">1x</li>
											<li data-value="1.25">1.25x</li>
											<li data-value="1.5">1.5x</li>
											<li data-value="1.75">1.75x</li>
											<li data-value="2">2x</li>
										  </ul>
										</span>
                                        <span class="theater-btn control-btn">
										  <span class="theater-default">
											<ion-icon name="tablet-landscape-outline"></ion-icon>
										  </span>
										  <span class="theater-active">
											<ion-icon name="tv-outline"></ion-icon>
										  </span>
										</span>
                                        <span class="fullscreen-btn control-btn" title="fullscreen">
										  <span class="full">
											<ion-icon name="scan-outline"></ion-icon>
										  </span>
										  <span class="contract">
											<ion-icon name="contract-outline"></ion-icon>
										  </span>
										</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slider-for-2 video-ft" th:if="${getEpisode.movieId.isApi == 1}">
                        <iframe th:src="${getEpisode.link}"></iframe>
                    </div>
                    <!--playlist-->
                    <div class="slider-nav-2 thumb-ft">
                        <div class="item" th:each="relateMovie:${relatedMovies}">
                            <div class="trailer-img">
                                <img th:src="${relateMovie.poster}" alt="photo by Barn Images" width="4096"
                                     height="2737">
                            </div>
                            <a th:href="'/movie/get/' + ${relateMovie.id}" class="d-flex justify-content-around">
                                <div class="trailer-infor" style="display: flex; flex-direction: column; justify-content: space-around; height: 100% !important;">
                                    <h4 class="desc"><span th:text="${relateMovie.name}"></span></h4>
                                    <h4 class="desc">Genre: <span  th:each="genre:${relateMovie.genreList}" th:text="${genre.name}"></span></h4>
                                </div>
                            </a>
                        </div>
                    </div>
                </section>
                <div class="viewMovie" style="margin-top: 10px">
                    <span style="margin-right: 2px; color: #abb7c4">View: </span><span style="color: #abb7c4" th:text="${getMovie.totalView}"></span>
                </div>
                <div class="frameTitleMovie marginFrame">
                    <p class="titleListEpisode">
                        <i class="ion-ios-film"></i>
                        <span>Danh sách tập phim</span>
                    </p>
                </div>

                <div class="listEpisode">
                    <ul>
                        <li th:each="episodeMovie:${getListEpisodeMovie}">
                            <span class="textListEpisode">
                                <a th:text="'Tập '+${episodeMovie.name}" th:href="'/movie/episodeMovie/' + ${episodeMovie.id}"></a>
                            </span>
                        </li>
                    </ul>
                </div>

                <div class="frameTitleMovie marginFrame">
                    <p class="titleListEpisode">
                        <span>Description</span>
                    </p>
                    <div style="background-color: #0f2133; padding: 12px">
                        <span th:text="${getEpisode.movieId.name}"></span>
                        -
                        <span th:text="'Episode: ' + ${getEpisode.name}"></span>
                        <p th:text="${getEpisode.movieId.description}"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Commend new v2 section-->
    <div class="page-single">
        <div class="container">
            <div class="row">
                <div class="col-md-9 col-sm-12 col-xs-12">
                    <div class="blog-detail-ct">
                        <!-- share link -->
                        <div class="flex-it share-tag">
                            <div class="social-link">
                                <h4>Share it</h4>
                                <a href="#"><i class="ion-social-facebook"></i></a>
                                <a href="#"><i class="ion-social-twitter"></i></a>
                                <a href="#"><i class="ion-social-googleplus"></i></a>
                                <a href="#"><i class="ion-social-pinterest"></i></a>
                                <a href="#"><i class="ion-social-linkedin"></i></a>
                            </div>
                            <div class="right-it">
                                <h4>Tags</h4>
                                <a href="#">Gray,</a>
                                <a href="#">Film,</a>
                                <a href="#">Poster</a>
                            </div>
                        </div>
                        <!-- comment items -->
                        <div class="comments">
                            <h4><span th:text="${getReviewByMovie.size()}"></span> Comments</h4>
                            <div class="cmt-item" style="display: flex" th:each="reviewByMovie:${getReviewByMovie}">
                                <img th:src="${reviewByMovie.account.avatar}" style="width: 70px; height: 70px; object-fit: cover" alt="">
                                <div class="author-infor" style="display: flex; flex-direction: column; justify-content: space-around; padding-top: 0px">
                                    <div class="flex-it2" style="margin-bottom: 8px">
                                        <h6><a href="#" th:text="${reviewByMovie.account.userName}"></a></h6> <span class="time" th:text="${#dates.format(reviewByMovie.createAt, 'dd MMMM yyyy')}"></span>
                                    </div>
                                    <div class="no-star" th:if="${reviewByMovie.status == 1}">
                                        <i class="ion-android-star" style="margin-right: 4px" th:each="i : ${#numbers.sequence(1, reviewByMovie.getStar())}"></i>
                                    </div>
                                    <div class="no-star" th:if="${reviewByMovie.status == 0}">
                                        <p style="color: #555555">Vote star are under consideration...</p>
                                    </div>
                                    <p th:text="${reviewByMovie.comment}"></p>
                                </div>
                            </div>
                        </div>
                        <div class="comment-form">
                            <h4>Leave a comment</h4>
                            <div class="card" th:if="${account_id != null and buyMovie == 1}">
                            <form id="formComment" method="post" th:attr="data-movieEpisode-id=${getMovie.id}">
                                <div class="col-2 d-flex userAndVote">
                                    <img th:src="${avatarAccount}" width="70" class="rounded-circle mt-2">
                                    <div class="nameUserAndVote">
                                        <span th:text="${nameAccount}"></span>
                                        <br>
                                        <div class="rating">
                                            <input type="radio" name="rating" value="10" id="10"><label for="10">☆</label>
                                            <input type="radio" name="rating" value="9" id="9"><label for="9">☆</label>
                                            <input type="radio" name="rating" value="8" id="8"><label for="8">☆</label>
                                            <input type="radio" name="rating" value="7" id="7"><label for="7">☆</label>
                                            <input type="radio" name="rating" value="6" id="6"><label for="6">☆</label>
                                            <input type="radio" name="rating" value="5" id="5"><label for="5">☆</label>
                                            <input type="radio" name="rating" value="4" id="4"><label for="4">☆</label>
                                            <input type="radio" name="rating" value="3" id="3"><label for="3">☆</label>
                                            <input type="radio" name="rating" value="2" id="2"><label for="2">☆</label>
                                            <input type="radio" name="rating" value="1" id="1"><label for="1">☆</label>
                                        </div>
                                        <span class="invalid-feedback text-danger"
                                              id="invalid-feedback-voteStar">Please choose star you vote film</span>
                                    </div>
                                </div>
                                <div class="col-10">
                                    <div class="comment-box ml-2">
                                        <div class="formTitle">
                                            <h4 for="title" style="color:black">Title</h4>
                                            <div class="title-area">
                                                <input id="title" class="form-control" placeholder="what is your Title?" rows="4">
                                            </div>
                                            <span class="invalid-feedback text-danger"
                                                  id="invalid-feedback-title">Please you input title</span>
                                        </div>
                                        <div class="formComment">
                                            <h4 for="comment" style="color:black">Comment</h4>
                                            <div class="comment-area">
                                                <textarea id="comment" class="form-control" placeholder="what is your comment?" rows="4"></textarea>
                                            </div>
                                            <span class="invalid-feedback text-danger"
                                                  id="invalid-feedback-comment">Please you input comment</span>
                                        </div>

                                    </div>
                                </div>
                                <div class="comment-btns mt-2">
                                    <button type="submit" class="buttonCommentSend">Send</button>
                                </div>
                            </form>
                            </div>
                            <div class="card" th:if="${account_id != null and buyMovie == 0}">
                                <p>You need to buy account in to review</p>
                            </div>
                            <div class="card" th:if="${account_id == null}">
                                <p>You need to log in to comment</p>
                            </div>
                        </div>
                        <!-- comment form -->
                    </div>
                </div>

            </div>
        </div>
    </div>
    <!--end of commend new v2 section-->

</main>

<th:block id="js-resources">
    <script>
        $(document).ready(function () {
            $("#formComment").submit(function (event){
                debugger;
                event.preventDefault();
                let accountId = $('.idAccount').text();
                let movieId = $('.idMovie').text();
                let title = $('#title').val();
                let comment = $('#comment').val();
                let rating = $('input[name="rating"]:checked').val();
// Kiểm tra xem các trường đã được nhập đủ hay chưa
                if (!rating) {
                    $('#invalid-feedback-voteStar').show();
                    return;
                } else {
                    $('#invalid-feedback-voteStar').hide();
                }

                if (title.trim() === '') {
                    $('#invalid-feedback-title').show();
                    return
                } else {
                    $('#invalid-feedback-title').hide();
                }
                if (comment.trim() === '') {
                    $('#invalid-feedback-comment').show();
                    return;
                } else {
                    $('#invalid-feedback-comment').hide();
                }

                var formData = {
                    accountId: accountId,
                    title: title,
                    comment: comment,
                    movies: movieId,
                    star: rating
                };
                $.ajax({
                    url: "/v1/reviews/add",
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(formData),
                    success: function (result) {
                        Swal.fire({
                            title: 'Success!',
                            text: 'Comment posted successfully.',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Reset form after successful post
                                $('#formComment')[0].reset();
                                setTimeout(function () {
                                    window.location.href = "/movie/get/"+movieId;
                                });
                            }
                        });
                    },
                    error: function (xhr, status, error) {
                        let errorMessage = "An error occurred.";
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        } else if (xhr.responseText) {
                            errorMessage = xhr.responseText;
                        }
                        Swal.fire({
                            title: 'Error!',
                            text: errorMessage,
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    }
                });
            })
        })
    </script>
    <script
            type="module"
            src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
            nomodule
            src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
    <script th:src="@{/public/js/jquery.js}"></script>
    <script th:src="@{/public/js/plugins.js}"></script>
    <script th:src="@{/public/js/plugins2.js}"></script>
    <script th:src="@{/public/js/custom.js}"></script>
    <script th:src="@{/public/js/myjs.js}"></script>
    <script th:src="@{/public/js/script_movie_home.js}"></script>
    <script  >
    </script>
</th:block>

<script th:src="@{/public/js/video-loader.js}"></script>
<script>
    loadVideoFromGoogleCloud('video-source', 'https://storage.cloud.google.com/testcloudvido/test.mp4');
</script>
</body>
</html>
